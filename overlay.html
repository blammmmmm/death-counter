<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Death Counter Overlay</title>
  <style>
    :root{
      --green: #9cff57;
      --bgAlpha: 0; /* transparent by default */
      --skullSize: 140px;
    }
    html,body{
      width:100%;
      height:100%;
      margin:0;
      background: rgba(0,0,0,var(--bgAlpha));
      overflow:hidden;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    /* container */
    .wrap{
      position:relative;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:flex-start;
      padding: 18px 20px;
      gap: 14px;
      color: var(--green);
      text-shadow: 0 0 10px rgba(156,255,87,.35);
      filter: saturate(1.1) contrast(1.05);
    }

    /* skull */
    .skull{
      width: var(--skullSize);
      height: var(--skullSize);
      flex: 0 0 auto;
      background-image: url("./skull.png");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      filter: drop-shadow(0 0 10px rgba(156,255,87,.25));
      opacity: .95;
    }

    /* number */
    .count{
      font-size: 96px;
      line-height: 1;
      font-weight: 800;
      letter-spacing: 1px;
      transform: translateY(2px);
    }
    .label{
      font-size: 18px;
      opacity: .85;
      margin-top: 6px;
      letter-spacing: .18em;
    }
    .stack{
      display:flex;
      flex-direction:column;
    }

    /* CRT overlays */
    .crt::before{
      content:"";
      pointer-events:none;
      position:absolute; inset:0;
      background:
        linear-gradient(to bottom,
          rgba(0,0,0,0) 0%,
          rgba(0,0,0,.12) 50%,
          rgba(0,0,0,0) 100%);
      opacity:.35;
      mix-blend-mode: multiply;
    }
    .crt::after{
      content:"";
      pointer-events:none;
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(0,0,0,0) 0px,
          rgba(0,0,0,0) 2px,
          rgba(0,0,0,.18) 3px
        );
      opacity:.28;
      mix-blend-mode: multiply;
      animation: scan 5.5s linear infinite;
    }
    @keyframes scan{
      0%{ transform: translateY(0); }
      100%{ transform: translateY(6px); }
    }

    /* animated noise */
    .noise{
      pointer-events:none;
      position:absolute; inset:0;
      opacity:.10;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
      animation: jitter 1.2s steps(2) infinite;
    }
    @keyframes jitter{
      0%{ transform: translate(0,0); }
      25%{ transform: translate(-1px,1px); }
      50%{ transform: translate(1px,-1px); }
      75%{ transform: translate(0px,1px); }
      100%{ transform: translate(0,0); }
    }

    /* vignette */
    .vignette{
      pointer-events:none;
      position:absolute; inset:-40px;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0) 35%, rgba(0,0,0,.35) 100%);
      opacity:.55;
    }

    /* tiny glitch flicker on update */
    .flash{
      animation: flash .18s ease-out 1;
    }
    @keyframes flash{
      0%{ filter: brightness(1.0) contrast(1.0); transform: translateX(0); }
      50%{ filter: brightness(1.25) contrast(1.2); transform: translateX(1px); }
      100%{ filter: brightness(1.0) contrast(1.0); transform: translateX(0); }
    }
  </style>
</head>
<body>
  <div class="wrap crt" id="wrap">
    <div class="skull" aria-hidden="true"></div>
    <div class="stack">
      <div class="count" id="count">0</div>
      <div class="label">DEATHS</div>
    </div>

    <div class="noise"></div>
    <div class="vignette"></div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const room = params.get("room") || "main";
    const key = `deathCounter:${room}`;

    const countEl = document.getElementById("count");
    const wrap = document.getElementById("wrap");

    function readCount(){
      const raw = localStorage.getItem(key);
      const n = Number(raw);
      return Number.isFinite(n) ? Math.max(0, Math.floor(n)) : 0;
    }

    function setUI(n){
      countEl.textContent = String(n);
      wrap.classList.remove("flash");
      // force reflow to restart animation
      void wrap.offsetWidth;
      wrap.classList.add("flash");
    }

    // init
    setUI(readCount());

    // live updates from controller (other tab/window)
    window.addEventListener("storage", (e) => {
      if (e.key === key) setUI(readCount());
    });

    // allow transparent=1
    if (params.get("transparent") === "0") {
      document.documentElement.style.setProperty("--bgAlpha", "0.35");
    }
  </script>
</body>
</html>
